[workspace]
allow_dirty = true         # allow updating repositories with uncommitted changes
publish = false            # disable automatic publishing - we'll batch publish manually to avoid rate limits
publish_allow_dirty = true # add `--allow-dirty` to `cargo publish`
publish_no_verify = true   # add `--no-verify` to `cargo publish`
publish_timeout = "10m"    # set a timeout for `cargo publish`
semver_check = false

# TEMPORARY: v2 Migration
# release-plz compares packages against old commits via git log. Old commits
# reference crates/tangle-extra which was renamed to crates/tangle-evm-extra.
# This breaks cargo when release-plz checks out old commits.
#
# To fix: Bump all versions (e.g., 0.2.0-alpha.1), create tags, remove this line.
# See: https://github.com/tangle-network/blueprint/issues/XXX
release = false

[changelog]
commit_preprocessors = [
    # Allow shortened crate names
    { pattern = '^(\w+!?)\(sdk\):', replace = "$1(blueprint-sdk):" },
    { pattern = '^(\w+!?)\(cli\):', replace = "$1(cargo-tangle):" },
]

commit_parsers = [
    { message = "^feat", group = "added" },
    { message = "^changed", group = "changed" },
    { message = "^deprecated", group = "deprecated" },
    { message = "^fix", group = "fixed" },
    { message = "^security", group = "security" },
    { message = "^.*", group = "other" },
    # Ignore CI commits
    { message = "^\\w+!?\\(ci\\)", skip = true },
    # Ignore Clippy commits
    { message = "^chore\\(clippy\\)", skip = true },
    { message = "^chore(?:\\(([^)]+)\\))?: clippy", skip = true },
    # Ignore any formatting commits
    { message = "^chore(?:\\(([^)]+)\\))?: fmt", skip = true },
    # Ignore dependency commits
    { message = "^chore\\(deps.*\\)", skip = true },
]
