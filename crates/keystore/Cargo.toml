[package]
name = "gadget-keystore"
version = "0.1.0"
authors.workspace = true
edition.workspace = true
license.workspace = true
homepage.workspace = true
repository.workspace = true

[dependencies]
# Core dependencies (always included)
gadget-std = { workspace = true, default-features = false }
async-trait = { workspace = true, default-features = false }
lock_api = { workspace = true, default-features = false }
parking_lot = { workspace = true, default-features = false }
thiserror = { workspace = true, default-features = false }
zeroize = { workspace = true, default-features = false }
serde = { workspace = true, features = ["derive"], default-features = false }
blake3 = { workspace = true, default-features = false }
serde_json = { workspace = true, default-features = false, features = ["alloc"] }

# Crypto primitives (optional)
k256 = { workspace = true, default-features = false, optional = true }
schnorrkel = { workspace = true, default-features = false, optional = true }
ed25519-zebra = { workspace = true, default-features = false, optional = true }
w3f-bls = { workspace = true, default-features = false, optional = true }
rust-bls-bn254 = { workspace = true, default-features = false, optional = true }

# EVM dependencies (optional)
alloy-network = { workspace = true, optional = true }
alloy-primitives = { workspace = true, optional = true }
alloy-signer = { workspace = true, optional = true }
alloy-signer-local = { workspace = true, optional = true, features = ["mnemonic"] }

# Substrate dependencies (optional)
sp-core = { workspace = true, default-features = false, optional = true }
sp-io = { workspace = true, default-features = false, optional = true }
subxt = { workspace = true, default-features = false, features = ["substrate-compat"], optional = true }
subxt-core = { workspace = true, default-features = false, optional = true }
tangle-subxt = { workspace = true, default-features = false, optional = true }

# Eigenlayer dependencies (optional)
eigensdk = { workspace = true, features = ["signer", "crypto-bls", "crypto-bn254"], default-features = false, optional = true }
ark-serialize = { workspace = true, default-features = false, optional = true }
ark-bn254 = { workspace = true, default-features = false, optional = true }
ark-ec = { workspace = true, default-features = false, optional = true }
ark-ff = { workspace = true, default-features = false, optional = true }

# Optional dependencies
hex = { workspace = true, default-features = false, optional = true }
paste = { workspace = true, default-features = false, optional = true }
tokio = { workspace = true, features = ["full"], optional = true }

# Hardware/Cloud wallet support (optional)
alloy-signer-aws = { workspace = true, optional = true }
alloy-signer-gcp = { workspace = true, optional = true }
alloy-signer-ledger = { workspace = true, features = ["eip712"], optional = true }
aws-config = { workspace = true, optional = true }
aws-sdk-kms = { workspace = true, optional = true }
gcloud-sdk = { workspace = true, optional = true }
ripemd = { workspace = true, optional = true }

[dev-dependencies]
tempfile = { workspace = true }

[features]
default = ["std", "tangle-full", "eigenlayer-full", "all-remote-signers"]

# Core features
std = [
    # Basic std dependencies
    "serde/std",
    "hex/std",
    "zeroize/std",
    "gadget-std/std",
    "thiserror/std",
    "tokio",
    "serde_json/std",

    # Conditional std enables for misc
    "hex?/std",

    # Condition std enables for alloy
    "alloy-primitives?/std",
    
    # Conditional std enables for crypto
    "k256?/std",
    "schnorrkel?/std",
    "ed25519-zebra?/std",
    "w3f-bls?/std",
    "rust-bls-bn254?/std",
    
    # Conditional std enables for protocols
    "alloy-primitives?/std",
    "sp-core?/std",
    "sp-io?/std",
    "subxt-core?/std",
    "subxt?/native",
    "ark-serialize?/std",
]

# Crypto primitive features
ecdsa = ["k256", "ripemd", "hex"]
sr25519-schnorrkel = ["schnorrkel", "hex"]
zebra = ["ed25519-zebra", "hex"]
# Meant to be used in conjunction with `tangle` feature (for `sp-core`)
substrate = ["paste", "sp-core", "sp-io", "subxt", "subxt-core", "tangle-subxt"]
sp-core-bls = ["sp-core/bls-experimental"]

bls381 = ["w3f-bls", "hex"]
bn254 = ["rust-bls-bn254", "arkworks"]
arkworks = ["ark-bn254", "ark-ec", "ark-ff", "ark-serialize"]

# Protocol features
evm = [
    "ecdsa",
    "alloy-primitives",
    "alloy-signer",
    "alloy-signer-local",
    "alloy-network",
]

tangle = [
    "substrate",
    "ecdsa",
]

eigenlayer = [
    "evm",
    "eigensdk",
    "bn254",
]

symbiotic = [
    "evm",
]

remote = []

# Optional protocol crypto features
tangle-full = ["tangle", "sp-core-bls", "bn254"]
eigenlayer-full = ["eigenlayer", "sr25519-schnorrkel", "zebra", "bls381"]
symbiotic-full = ["symbiotic", "sr25519-schnorrkel", "zebra", "bls381", "bn254"]

# Hardware/Cloud wallet support
aws-signer = ["remote", "alloy-signer-aws", "aws-config", "aws-sdk-kms", "evm", "std"]
gcp-signer = ["remote", "alloy-signer-gcp", "gcloud-sdk", "evm", "std"]
ledger-browser = ["remote", "evm", "alloy-signer-ledger/browser"]
ledger-node = ["remote", "evm", "alloy-signer-ledger/node", "std"]
all-remote-signers = ["remote", "aws-signer", "gcp-signer", "ledger-browser", "ledger-node", "std"]

web = [
    "subxt/web",
]