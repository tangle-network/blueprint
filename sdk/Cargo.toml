[package]
name = "gadget-sdk"
version = "0.1.0"
authors.workspace = true
edition.workspace = true
homepage.workspace = true
repository.workspace = true


[dependencies]
thiserror = { workspace = true }
tracing = { workspace = true }
async-trait = { workspace = true }
futures = { workspace = true }
parking_lot = { workspace = true }
rand_core = { version = "0.6.4", default-features = false }
rand = { workspace = true, optional = true }
hex = { workspace = true, default-features = false }

# Keystore deps
k256 = { version = "0.13.3", optional = true }
elliptic-curve = { version = "0.13", default-features = false, optional = true }
ed25519-zebra = { version = "4", default-features = false, optional = true, features = [] }
schnorrkel = { version = "0.11.4", default-features = false, optional = true, features = ["preaudit_deprecated", "getrandom"] }
w3f-bls = { version = "0.1.3", default-features = false, optional = true }

# Metrics deps
hyper = { version = "0.14.29", default-features = false, features = ["http1", "server", "tcp"], optional = true }
prometheus = { version = "0.13.0", default-features = false, optional = true }
tokio = { version = "1.22.0", features = ["rt-multi-thread", "parking_lot"], optional = true }

# Logging deps
tracing-subscriber = { workspace = true, default-features = false, optional = true }
tracing-wasm = { version = "0.2.1", optional = true }

# WASM-only deps
getrandom = { version = "0.2.15", optional = true }
wasm-bindgen-test = { version = "0.3.42", optional = true }

# Macros
gadget-blueprint-proc-macro = { workspace = true, optional = true }
tangle-subxt = { workspace = true, default-features = false, optional = true }
# Event Watchers and Handlers
subxt = { workspace = true, default-features = false, optional = true }
backoff = { version = "0.4.0", features = ["tokio"], optional = true }

[target.'cfg(not(target_family = "wasm"))'.dev-dependencies]
hyper = { version = "0.14.16", default-features = false, features = ["client"] }
slog-term = { version = "2.9.1" }

[features]
default = ["full", "std"]
std = [
  "alloc",
  "rand",
  "getrandom",
  "hex/std",
]
alloc = ["rand_core/alloc", "hex/alloc"]
full = [
  "events-watcher",
  "keystore",
  "macros",
  "tx-tangle",
]
wasm = [
  "getrandom/js",
  "tracing-wasm",
  "wasm-bindgen-test",
]

# Randomness
getrandom = ["rand_core/getrandom"]

# Keystore features
keystore = [
  "keystore-ecdsa",
  "keystore-sr25519",
  "keystore-ed25519",
  "keystore-bls381",
  "keystore-fs",
]
keystore-ecdsa = ["k256", "elliptic-curve/sec1"]
keystore-sr25519 = ["schnorrkel"]
keystore-ed25519 = ["ed25519-zebra"]
keystore-bls381 = ["w3f-bls"]
# Keystore backends
# Requires: std
keystore-fs = []

metrics = ["hyper", "prometheus", "tokio"]
logging = ["tracing-subscriber"]

macros = ["gadget-blueprint-proc-macro", "tangle-subxt"]

events-watcher = ["subxt/jsonrpsee", "subxt/native", "backoff", "tokio/time"]
tx-tangle = ["tangle-subxt", "backoff"]
